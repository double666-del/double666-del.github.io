---
title: "2020-10-24-ggplot2???????????????????????????"
output:
  html_document:
    df_print: paged
---



```{r include=FALSE}
library(ggplot2)
library(cowplot)
setwd('D:/R')
data<-read.csv('zhaojiarui_shixiong/data/???????????????????????????.csv')
#data$year<-as.factor(data$year)
data$type<-factor(data$type,levels=c('pH','SOM','TN','AN','AP','AK'))
data_1980<-data[which(data$year==1980),]
data_2010<-data[which(data$year==2010),]
theme_fig<-theme(rect=element_rect(fill='white'),
                 title=element_text(size=7,family='Times'),
                 axis.title.x=element_text(size=7),
                 axis.title.y=element_text(size=7),
                 axis.text.x=element_text(size=7),
                 axis.text.y=element_text(size=7),
                 plot.margin=unit(rep(0.5,4), 'lines'),
                 panel.spacing=unit(0.7, 'lines'),
                 #panel.background=element_rect(fill='transparent', color='black'),
                 #panel.border=element_rect(fill='transparent', color='transparent'),
                 #panel.grid=element_blank(),
                 #legend.key.size=unit(0.3,'cm'),
                 #legend.key.width=unit(0.3,'cm'),
                 legend.position='none',
                 strip.text.x = element_text(family = 'Times',size=8),
                 strip.text.y = element_text(family = 'Times',size=8))
```

???????????????ggplot?????????scale_x_continuous??????limits???breaks??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????AI????????????????????????????????????????????????????????????????????????????????? ??????????????????????????????ggplot2??????????????????????????????????????????????????????

label:

- NULL for no labels
- waiver() for the default labels computed by the transformation object
- A character vector giving labels (must be same length as breaks)
- A function that takes the breaks as input and returns labels as output
  
limits:

- NULL to use the default scale range
- A numeric vector of length two providing limits of the scale. Use NA to refer to the existing minimum or maximum
- A function that accepts the existing (automatic) limits and returns new limits Note that setting limits on positional scales will remove data outside of the limits. If the purpose is to zoom, use the limit argument in the coordinate system (see coord_cartesian()).

???????????????????????????????????????

```{r eval=FALSE, include=FALSE}
LimitsFunc1=function(lim){
  print(lim[2])
}
ggplot(data=data_1980)+
  geom_point(aes(x=`X`,y=`Y`,colour=type))+
  scale_y_continuous(limits=LimitsFunc1)
```

output: 6933 

????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????

??????????????????????????????

???????????????

```{r pressure, echo=TRUE, message=FALSE, warning=FALSE}

p_1980<-ggplot(data=data_1980)+
  geom_point(aes(x=`X`,y=`Y`,colour=type))+
  facet_grid(type~year,scales = "free_y")+
  xlab('Distance (Km)')+ylab('Semivariance')+
  scale_x_continuous(limits=c(0,900),breaks=seq(0,900,100),expand = c(0,0))+
  theme_fig+theme(strip.text.y = element_blank())
p_2010<-ggplot(data=data_2010)+
  geom_point(aes(x=`X`,y=`Y`,colour=type))+
  facet_grid(type~year,scales = "free_y")+
  xlab('Distance (Km)')+ylab('')+
  scale_x_continuous(limits=c(0,900),breaks=seq(0,900,100),expand = c(0,0))+
  theme_fig
fig<-ggdraw()+draw_plot(p_1980, x=0, y=0, width = 0.5, height = 1)+ 
  draw_plot(p_2010, x=0.5, y=0, width = 0.5, height = 1)
fig
```

???????????????

```{r echo=TRUE, message=FALSE, warning=FALSE}

LimitsFunc=function(lim){
  lim[2]<-round(lim[2],2)
  lim[1]<-0
  if(round(lim[2]==0.27)){
    lim[2]<-0.40
  }else if(lim[2]==29.71){
    lim[2]<-40
  }else if(lim[2]==0.16){
    lim[2]<-0.20
  }else if(lim[2]==387.6){
    lim[2]<-480
  }else if(lim[2]==13.27){
    lim[2]<-20
  }else if(lim[2]==6933){
    lim[2]<-8000
  }else if(lim[2]==0.14){
    lim[2]<-0.20
  }else if(lim[2]==13.11){
    lim[2]<-20
  }else if(lim[2]==0.09){
    lim[2]<-0.12
  }else if(lim[2]==950.5){
    lim[2]<-1200
  }else if(lim[2]==258.42){
    lim[2]<-320
  }else if(lim[2]==5050.49){
    lim[2]<-6000
  }else{
    print('error!')
  }
  lim
}

BreakFunc = function(lim) {
  x<-seq(lim[1], lim[2], (lim[2]-lim[1])/4)
  for (i in 1:length(x)) {
    x[i]=ifelse(x[i]<1,round(x[i],2),ifelse(x[i]<10,round(x[i],0),round(x[i],0)))
  }
  x
}
p_1980<-ggplot(data=data_1980)+
  geom_point(aes(x=`X`,y=`Y`,colour=type))+
  facet_grid(type~year,scales = "free_y")+
  xlab('Distance (Km)')+ylab('Semivariance')+
  scale_x_continuous(limits=c(0,900),breaks=seq(0,900,100),expand = c(0,0))+
  scale_y_continuous(limits=LimitsFunc,breaks = BreakFunc,
                     expand = expand_scale(mult = 0, add = 0))+
  theme_fig+theme(strip.text.y = element_blank())
p_2010<-ggplot(data=data_2010)+
  geom_point(aes(x=`X`,y=`Y`,colour=type))+
  facet_grid(type~year,scales = "free_y")+
  xlab('Distance (Km)')+ylab('')+
  scale_x_continuous(limits=c(0,900),breaks=seq(0,900,100),expand = c(0,0))+
  scale_y_continuous(limits=LimitsFunc,breaks = BreakFunc,
                     expand = expand_scale(mult = 0, add = 0))+
  theme_fig
fig<-ggdraw()+draw_plot(p_1980, x=0, y=0, width = 0.5, height = 1)+ 
  draw_plot(p_2010, x=0.5, y=0, width = 0.5, height = 1)
fig
```

????????????????????????????????????????????????????????????????????????????????????
